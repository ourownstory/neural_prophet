<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Modelling Lagged Regressors" href="lagged-regressors.html" /><link rel="prev" title="Modelling Seasonality" href="seasonality.html" />

    <link rel="shortcut icon" href="../_static/swiss_favicon.png"/><meta name="generator" content="sphinx-4.2.0, furo 2021.10.09"/>
        <title>Modelling Auto-Regression - NeuralProphet documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=0254c309f5cadf746f1a613e7677379ac9c8cdcd" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">NeuralProphet  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/np_logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="model-overview.html">Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes-from-prophet.html">Changes from prophet</a></li>
<li class="toctree-l1"><a class="reference internal" href="trend.html">Trend</a></li>
<li class="toctree-l1"><a class="reference internal" href="seasonality.html">Seasonality</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Auto-regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="lagged-regressors.html">Lagged-regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="future-regressors.html">Future-regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperparameter-selection.html">Hyperparameter-selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../example_links/autoregression_yosemite_temps.html">Autoregression Yosemite Temperature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/crossvalidation.html">Crossvalidation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/energy_data_example.html">Example on PV forecasting dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/events_holidays_peyton_manning.html">Modeling Holidays and Special Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/season_multiplicative_air_travel.html">Multiplicative Seasonality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/sparse_autoregression_yosemite_temps.html">Sparse Autoregression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/sub_daily_data_yosemite_temps.html">Sub-daily data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_links/trend_peyton_manning.html">Peyton Manning</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="modelling-auto-regression">
<h1>Modelling Auto-Regression<a class="headerlink" href="#modelling-auto-regression" title="Permalink to this headline">¶</a></h1>
<p>AR-Net can be enabled in the NeuralProphet by simply setting an appropriate value to the
<code class="docutils literal notranslate"><span class="pre">n_lags</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">NeuralProphet</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">NeuralProphet</span><span class="p">(</span>
    <span class="n">n_forecasts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_lags</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">daily_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In the above example, we create a forecasting scenario which feeds 5 lags into AR-Net and receives
3 steps as forecasts. Once you have the AR-Net enabled, during forecasting your <code class="docutils literal notranslate"><span class="pre">future_periods</span></code> value
should be equal to the <code class="docutils literal notranslate"><span class="pre">n_forecasts</span></code> value specified when creating the <code class="docutils literal notranslate"><span class="pre">NeuralProphet</span></code> object. Whichever
value you specify for <code class="docutils literal notranslate"><span class="pre">future_periods</span></code>, it will be converted to the value of <code class="docutils literal notranslate"><span class="pre">n_forecasts</span></code> with a notice
to the user. This is because, since the AR-Net is built during training such that it has an ouptut size
of <code class="docutils literal notranslate"><span class="pre">n_forecasts</span></code>, it cannot support any other value during testing.</p>
<p>The plotted components should look like below.</p>
<p><img alt="plot-comp-1" src="../_images/plot_comp_ar_1.png"/>{: style=”height:600px”}</p>
<p>You can now see auto-regression as a separate component. The corresponding coefficients look like
below.</p>
<p><img alt="plot-param-1" src="../_images/plot_param_ar_1.png"/>{: style=”height:600px”}</p>
<p>You can see the relevance of each of the lags when modelling the autocorrelation. You can also specify the <code class="docutils literal notranslate"><span class="pre">num_hidden_layers</span></code>
for the AR-Net, in order to increase the complexity of the AR-Net.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">NeuralProphet</span><span class="p">(</span>
    <span class="n">n_forecasts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_lags</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">num_hidden_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">daily_seasonality</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="regularize-ar-net">
<h2>Regularize AR-Net<a class="headerlink" href="#regularize-ar-net" title="Permalink to this headline">¶</a></h2>
<p>Regularization in AR-Net is done by setting the <code class="docutils literal notranslate"><span class="pre">ar_sparsity</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">NeuralProphet</span></code> object
like below. For more details on setting a value for <code class="docutils literal notranslate"><span class="pre">ar_sparsity</span></code>, refer to the Section on
<a class="reference external" href="../hyperparameter-selection.md#regularization-related-parameters">Hyperparameter Selection</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">NeuralProphet</span><span class="p">(</span>
    <span class="n">n_forecasts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_lags</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">num_hidden_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ar_sparsity</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">daily_seasonality</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="highlight-specific-forecast-step">
<h2>Highlight Specific Forecast Step<a class="headerlink" href="#highlight-specific-forecast-step" title="Permalink to this headline">¶</a></h2>
<p>When modelling the autocorrelation, the model in the multi-input, multi-output mode. In this mode, you can highlight the nth step
ahead forecast. This means that, you can specifically look at the forecast at the nth step when calculating errors during model training
as well as when forecast plotting. This can be done like below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">NeuralProphet</span><span class="p">(</span>
    <span class="n">n_forecasts</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">n_lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">daily_seasonality</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">highlight_nth_step_ahead_of_each_forecast</span><span class="p">(</span><span class="n">step_number</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">n_forecasts</span><span class="p">)</span>
</pre></div>
</div>
<p>You can specify any value less than or equal to <code class="docutils literal notranslate"><span class="pre">n_forecasts</span></code> to the <code class="docutils literal notranslate"><span class="pre">step_number</span></code> parameter.
Once you do this, the metrics would look like below.</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>SmoothL1Loss</p></th>
<th class="text-align:center head"><p>MAE</p></th>
<th class="text-align:center head"><p>SmoothL1Loss-3</p></th>
<th class="text-align:center head"><p>MAE-3</p></th>
<th class="text-align:right head"><p>RegLoss</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>0.272427</p></td>
<td class="text-align:center"><p>3.063127</p></td>
<td class="text-align:center"><p>0.164296</p></td>
<td class="text-align:center"><p>2.407697</p></td>
<td class="text-align:right"><p>0.0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>0.151259</p></td>
<td class="text-align:center"><p>2.303768</p></td>
<td class="text-align:center"><p>0.144811</p></td>
<td class="text-align:center"><p>2.261525</p></td>
<td class="text-align:right"><p>0.0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>0.129990</p></td>
<td class="text-align:center"><p>2.140769</p></td>
<td class="text-align:center"><p>0.127703</p></td>
<td class="text-align:center"><p>2.126293</p></td>
<td class="text-align:right"><p>0.0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>0.116178</p></td>
<td class="text-align:center"><p>2.020397</p></td>
<td class="text-align:center"><p>0.113719</p></td>
<td class="text-align:center"><p>2.005068</p></td>
<td class="text-align:right"><p>0.0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>0.104502</p></td>
<td class="text-align:center"><p>1.915078</p></td>
<td class="text-align:center"><p>0.101155</p></td>
<td class="text-align:center"><p>1.887193</p></td>
<td class="text-align:right"><p>0.0</p></td>
</tr>
</tbody>
</table></div>
<br/>
<p>In the forecast plots, it will focus only on the nth step ahead forecast. This is shown below for the fir of the model.</p>
<p><img alt="plot-forecast-1" src="../_images/plot_forecast_ar_1.png"/>{: style=”height:400px”}</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lagged-regressors.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Modelling Lagged Regressors</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="seasonality.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Modelling Seasonality</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Oskar Triebe |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>. |
            <a class="muted-link" href="../_sources/model/auto-regression.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Modelling Auto-Regression</a><ul>
<li><a class="reference internal" href="#regularize-ar-net">Regularize AR-Net</a></li>
<li><a class="reference internal" href="#highlight-specific-forecast-step">Highlight Specific Forecast Step</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/main.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    </body>
</html>